# 待测试

- pre-commit 提取词条成功继续提交，done
- 包含 node_modules 的包，词条提取，done

# 优化

- 目前切换语言时会刷新页面，初始化时只添加默认语言包，其他的语言包使用空的占位，减少网络请求
- 动态 import 语言包到单独的 chunk

# 记录

- 依赖的包所需的 node 版本过高时，兼容到 node 14 即可
  - eslint v8
  - prettier v3
  - husky v8
- **ESM 和 CommonJS 相互引用时，在导入的时候需要加上后缀**
- 兼容到 node 12
- 词条处理
  - vue
  - js
  - 行内注释标识该词条不用提取
    ```js
    let disabled = /* i18n-tool-extract-ignored */ '不用提取';
    ```
  - .env
    - 环境变量在构建产物中是静态替换成了字符串
    - 提取阶段使用 dotenv 读取文件成 js
    - 构建阶段把 process.env.VUE_APP_XX 和 process.env.VITE_XX 替换成 t 函数
    - vue cli、webpack 在自定义插件和 loader 中可以通过 process.env 直接获取到已经合并过的所有环境变量
  - ts
  - jsx
  - tsx
  - html
  - css
    - 样式文件内的中文需要收集起来，提示用户需手动改
  - less
  - scss

# 业务工程需要做的

- nodejs >= 14.21.3
- .browserlistrc 需要配置 not dead，否则业务工程的 babel 为了兼容老浏览器会把 js 代码的模板字符串转成''.concat()的形式，转换结果与本工具使用的 babel 转换后的不一致，导致无法把模板字符串当成一个词条来处理
- 把 vue-loader 的 compilerOptions.comments 设置为 false

```js
// webpack chain
config.module
  .rule('vue')
  .use('vue-loader')
  .loader('vue-loader')
  .tap(options => {
    options.compilerOptions.comments = false;
    return options;
  })
  .end();
```

- 把@vitejs/plugin-vue 的 compilerOptions.comments 设置为 false

```js
// vite.config.js
vue({
  template: {
    compilerOptions: {
      // 不保留template中的注释，否则会导致i18n-tool做冗余的词条提取
      comments: false
    }
  }
});
```
